import { writable, derived } from "svelte/store";

let loadedstate = sessionStorage.getItem("state");
let loadedparams = sessionStorage.getItem("params");

// export const state = writable(
//   loadedstate == null ? defaultState : JSON.parse(loadedstate)
// );

// export const params = writable(
//   loadedparams == null ? defaultParams : JSON.parse(loadedparams)
// );

// export const mouse = writable({
//   X: 0.0,
//   Y: 0.0,
//   down: false,
//   moved: false,
// });

// export const touchDist = writable({
//   X: 0.0,
//   Y: 0.0,
// });

export const showInfo = writable(false);

export const canvasses = writable({
  manset: {},
  jPreview: {},
});

export const targetIsUI = writable(false);

const defaults = {
  m_mandelbrot: { cx: -0.5, cy: 0.0, xwidth: 3.0 },
  m_burningship: { cx: -0.5, cy: 0.5, xwidth: 3.0 },
  j: { cx: 0.0, cy: 0.0, xwidth: 3.0 },
};

export const state = writable({
  m: { cx: -0.5, cy: 0.0, xwidth: 3.0 },
  j: { cx: 0.0, cy: 0.0, xwidth: 3.0, jx: 0.0, jy: 0.0 },
  params: {
    xres: 512,
    yres: 512,
    resScale: 1,
    maxiter: 384,
    julia: false,
    whichfractal: "mandelbrot",
    jPreview: false,
  },
  mouse: {
    X: 0.0,
    Y: 0.0,
    dX: 0.0,
    dY: 0.0,
    separation: 0.0,
    separationRatio: 0.0,
    down: false,
    moved: false,
    uiTarget: false,
  },
  get active() {
    return this.params.julia ? this.j : this.m;
  },
  get defaults() {
    if (this.params.julia) {
      return defaults.j;
    } else if (this.params.whichfractal == "burningship") {
      return defaults.m_burningship;
    } else if (this.params.whichfractal == "mandelbrot") {
      return defaults.m_mandelbrot;
    }
  },
});

export const workers = writable({
  finalworker: new Worker("./mainworker.js"),
  tmpworker: new Worker("./mainworker.js"),
  jPreviewWorker: {},
});

export const shufflePoints = writable({
  mandelbrot: [
    [-1.9096053891939817, 0.00000103776008438338, 0.0000016150538997697704],
    [-1.9095746109716247, 7.53804721541762e-8, 1.0899113994514348e-7],
    [-1.9095724748014338, 0.00001211600163716944, 4.899319593741794e-7],
    [-1.9073072644350397, 0.00009509219408593862, 0.00005582120848629018],
    [-1.8227760752702757, 0.0005580893111564394, 6.683288090418636e-8],
    [-1.7862258115594223, -0.000049523788209623106, 0.0005580050734656468],
    [-1.786126274321025, 0.00005230166256451692, 0.000002255492414652362],
    [-1.7841232957701672, -0.0002457079935486778, 0.0022262687903866914],
    [-1.7792821637432452, 0.00027968727463771424, 1.635040896930643e-7],
    [-1.7772450411744503, 0.00028831810555169344, 0.00004293663046242284],
    [-1.7688912028190518, 0.0024445607185996803, 0.0003546326133708414],
    [-1.7667454438835195, 0.00879116033774118, 2.6684053716681224e-9],
    [-1.7676648858027193, 0.009422542688048544, 0.00003224747087777066],
    [-0.7555533482554546, 0.07769994523705666, 0.009771498023889255],
    [-1.1076123976790764, 0.2840995543331405, 0.0001466968360837343],
    [-1.374497186767938, 0.015947763923275078, 0.000004144264909471557],
    [-1.3738651292949937, 0.015864985022268876, 0.00001576394492891991],
    [-0.5337124249873497, -0.5229877312348364, 0.02096592118063148],
    [-0.5465359793735114, -0.527401219619759, 0.004892056039379949],
    [-0.3843290632624002, -0.6690661552852547, 0.0020479248248862075],
    [-0.3097765468224304, -0.6418482070683095, 0.0016132577513069482],
    [-0.0013108224032830496, -0.7544196526364724, 0.012404275363461018],
    [0.1803310189590987, -0.6007329373668032, 0.001255778368693401],
    [0.3500896804164273, -0.5035225054088759, 0.00007432442097013812],
    [0.3659777346819825, -0.134926609904475, 0.0033001563116455924],
    [0.3703879101998372, -0.13560873506114163, 0.000019539530944329427],
    [0.37038150631641575, -0.13561261938387265, 0.0000025412447586979482],
    [0.43430532619615225, 0.23199135088326772, 0.00005649106298812535],
    [0.3545681536746981, 0.6192738000258634, 4.4550517905939716e-8],
    [0.000683043200829224, 0.7513112750000731, 0.00004450097197792704],
    [-0.1643310247335018, 1.097532407255026, 0.0011551793327505694],
    [-0.16390414088937594, 1.0985526964902153, 2.608399099161531e-12],
    [-1.9669774818252177, -1.4595811576186363e-7, 3.7684650801758036e-7],
    [-1.9674577680184022, -2.1331630974905806e-7, 4.0089771273651446e-13],
    [-1.999095686956214, -1.53662051062036e-7, 5.594557670036736e-11],
  ],
  burningship: [
    [-1.9979635869541563, 0.0000011359329915018754, 0.0000018859652368619733],
    [-1.9979630268660573, 0.0000027751064420295625, 8.496592296675621e-12],
    [-1.9979630268537862, 0.0000027801784154186242, 2.2337130371852763e-12],
    [-1.9979629929454183, 0.000004563626036470285, 4.1504181696176927e-10],
    [-1.997962992749267, 0.000004563713417195649, 2.6083990991615417e-12],
    [-1.9979624509605047, 5.258118499198978e-7, 6.009645163260302e-11],
    [-1.9979630685791732, 1.3640517350648648e-7, 1.3195944543908089e-8],
    [-1.9979627372037967, 2.804711153159099e-7, 5.0213323696944565e-9],
    [-1.997962739465264, 2.815277809795838e-7, 5.729632670422114e-11],
    [-1.9979629830406975, -6.734508510774695e-9, 4.961790879144715e-9],
    [-1.9979627964181332, 5.778156982328562e-8, 6.147897168273773e-8],
    [-1.940600712902369, 0.0009675674692441495, 0.008170590805538542],
    [-1.9419990636571083, 0.006621657767202815, 7.52721325913118e-7],
    [-1.9419985377211446, 0.0066219843688362446, 7.90093418429281e-9],
    [-1.9419995187698416, 0.0066222674494270635, 2.4282364083563127e-12],
    [-1.9419984376429322, 0.00662160125324975, 2.7004262361281245e-9],
    [-1.941958833174727, 0.006529260431958096, 0.0000014164504386393355],
    [-1.9419581313092367, 0.006529589491987744, 3.644093222009327e-13],
    [-1.9419201309844523, 0.0011781660322168926, 3.1510609795756116e-7],
    [-1.9411291491639944, 0.0013463231584249808, 0.0000045051690935793215],
    [-1.593137313825297, 0.023760460908030984, 0.025073885384969134],
    [-1.5056418868905952, 0.0005573940225200031, 4.30003812753666e-9],
    [-1.501808667220457, -0.000019320779177113443, 1.451725755285047e-8],
    [-1.052918573750445, -0.03343127760568184, 0.00010757897996563997],
    [0.9750440442604511, 1.1932534343434695, 0.00036319486318806427],
    [0.9923383537927891, 1.2057862533953176, 0.00007795672474801148],
    [0.9923517276228864, 1.2058216700014206, 5.083473550141226e-10],
    [0.980386934286482, 1.2157948637053766, 5.588335799571201e-8],
    [0.9803869882371988, 1.2157948973601935, 8.10370860506837e-13],
    [0.9705233309604187, 1.1971200744364163, 0.00026006705957317094],
    [0.20904378500422957, 1.1108875819851578, 8.915134840221706e-13],
  ],
});
